
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Budget Pro V5</title>
    <style>
        :root {
            --bg: #f2f2f7;
            --card: #ffffff;
            --blue: #007aff;
            --red: #ff3b30;
            --text: #1c1c1e;
            --gray: #8e8e93;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding-bottom: 100px;
            overflow-x: hidden;
        }

        /* Top Bar */
        .header {
            padding: 20px 15px 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: var(--bg);
            z-index: 10;
        }

        .search-trigger, .settings-trigger {
            background: #e3e3e8;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 20px;
            font-size: 18px;
            cursor: pointer;
        }

        .banner {
            background: var(--card);
            padding: 15px;
            border-radius: 18px;
            box-shadow: var(--shadow);
            flex-grow: 1;
            margin: 0 12px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }

        /* Summary Grid */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 15px;
        }

        .stat-card {
            background: var(--card);
            padding: 15px 10px;
            border-radius: 18px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-card h5 { margin: 0; color: var(--gray); font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-card p { margin: 5px 0 0; font-size: 16px; font-weight: 700; }

        /* Tabs & Lists */
        .list-container { padding: 0 15px; }
        .item-card {
            background: var(--card);
            padding: 16px;
            border-radius: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
        }

        .item-info strong { display: block; font-size: 16px; }
        .item-info small { color: var(--gray); font-size: 13px; }
        .item-right { text-align: right; display: flex; align-items: center; gap: 12px; }
        .delete-btn { color: var(--red); background: none; border: none; font-size: 18px; cursor: pointer; }

        /* Bottom Sheet (The Add UI) */
        .sheet {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--card);
            border-radius: 30px 30px 0 0;
            padding: 25px;
            z-index: 1000;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.15, 0.85, 0.35, 1);
            box-shadow: 0 -10px 30px rgba(0,0,0,0.1);
        }

        .sheet.active { transform: translateY(0); }
        .overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(4px);
            z-index: 999;
            display: none;
        }

        /* Inputs */
        input, select {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            border: 1px solid #e5e5ea;
            background: #f2f2f7;
            font-size: 17px;
            margin: 15px 0;
            outline: none;
        }

        .btn-blue {
            width: 100%;
            padding: 18px;
            background: var(--blue);
            color: white;
            border: none;
            border-radius: 16px;
            font-weight: 600;
            font-size: 17px;
            cursor: pointer;
        }

        /* Nav Bar */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%;
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(20px);
            display: flex;
            padding: 10px 0 30px;
            border-top: 0.5px solid #d1d1d6;
            z-index: 100;
        }

        .nav-tab {
            flex: 1; border: none; background: none;
            display: flex; flex-direction: column; align-items: center;
            color: var(--gray); cursor: pointer;
        }

        .nav-tab.active { color: var(--blue); }
        .nav-tab span { font-size: 10px; font-weight: 600; margin-top: 4px; }

        .fab {
            position: fixed; bottom: 100px; right: 20px;
            width: 60px; height: 60px; border-radius: 30px;
            background: var(--blue); color: white; border: none;
            font-size: 30px; box-shadow: 0 8px 20px rgba(0,122,255,0.4);
            z-index: 90; cursor: pointer;
        }

        /* Trends Bars */
        .bar-chart { display: flex; align-items: flex-end; justify-content: space-around; height: 150px; margin: 20px 0; }
        .bar-container { display: flex; flex-direction: column; align-items: center; flex: 1; }
        .bar { width: 35px; background: var(--blue); border-radius: 8px 8px 0 0; transition: height 0.5s ease; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header class="header">
        <button class="search-trigger" onclick="toggleSearch()">üîç</button>
        <div class="banner" id="savingsBanner">On track to save $0</div>
        <button class="settings-trigger" onclick="openSettings()">‚öôÔ∏è</button>
    </header>

    <div id="searchBar" class="list-container hidden">
        <input type="text" id="searchInput" placeholder="Search merchants..." oninput="render()">
    </div>

    <main id="mainContent">
        <section id="monthView">
            <div class="summary-grid">
                <div class="stat-card"><h5>Spent</h5><p id="totalSpent">$0</p></div>
                <div class="stat-card"><h5>Income</h5><p id="totalIncome">$0</p></div>
                <div class="stat-card"><h5>Saved</h5><p id="totalSaved">$0</p></div>
            </div>
            <div id="purchaseList" class="list-container"></div>
        </section>

        <section id="trendsView" class="hidden">
            <div style="padding: 15px">
                <h2 style="margin-bottom: 0;">Spending Trends</h2>
                <div class="stat-card" style="margin-top: 15px; text-align: left;">
                    <h5>Weekly Spending</h5>
                    <div id="weeklyChart" class="bar-chart"></div>
                </div>
                <div id="categoryChart" style="margin-top: 20px;"></div>
            </div>
        </section>
    </main>

    <div id="overlay" class="overlay" onclick="closeAll()"></div>

    <div id="addSheet" class="sheet">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 id="stepTitle" style="margin:0">Amount</h3>
            <button onclick="closeAll()" style="background:none; border:none; font-size:20px; color:var(--gray)">‚úï</button>
        </div>
        <div id="stepContainer"></div>
        <button id="nextBtn" class="btn-blue" style="margin-top:20px" onclick="handleNext()">Next</button>
    </div>

    <div id="settingsSheet" class="sheet">
        <h3>Settings</h3>
        <label style="font-size: 13px; color: var(--gray);">Biweekly Paycheck ($)</label>
        <input type="number" id="payInput" placeholder="2000">
        <button class="btn-blue" onclick="saveSettings()">Save Settings</button>
    </div>

    <nav class="bottom-nav">
        <button class="nav-tab active" id="tabMonth" onclick="switchTab('month')">
            <span style="font-size:20px">üìÖ</span><span>This Month</span>
        </button>
        <button class="nav-tab" id="tabTrends" onclick="switchTab('trends')">
            <span style="font-size:20px">üìà</span><span>Trends</span>
        </button>
    </nav>

    <button class="fab" onclick="openAdd()">+</button>

    <script>
        // Data State
        let purchases = JSON.parse(localStorage.getItem('v5_data') || '[]');
        let settings = JSON.parse(localStorage.getItem('v5_set') || '{"pay": 4000}');
        let currentStep = 0;
        let tempItem = {};
        const steps = ["amount", "merchant", "category", "date"];

        // Navigation
        function switchTab(tab) {
            document.getElementById('monthView').classList.toggle('hidden', tab !== 'month');
            document.getElementById('trendsView').classList.toggle('hidden', tab !== 'trends');
            document.getElementById('tabMonth').classList.toggle('active', tab === 'month');
            document.getElementById('tabTrends').classList.toggle('active', tab === 'trends');
            if(tab === 'trends') renderTrends();
        }

        // Add Purchase Flow
        function openAdd() {
            currentStep = 0;
            tempItem = { date: new Date().toISOString().split('T')[0] };
            updateStepUI();
            document.getElementById('addSheet').classList.add('active');
            document.getElementById('overlay').style.display = 'block';
        }

        function updateStepUI() {
            const container = document.getElementById('stepContainer');
            const step = steps[currentStep];
            document.getElementById('stepTitle').innerText = "Enter " + step.charAt(0).toUpperCase() + step.slice(1);

            if(step === 'amount') container.innerHTML = `<input type="number" id="stepInput" placeholder="0.00" autofocus>`;
            else if(step === 'merchant') container.innerHTML = `<input type="text" id="stepInput" placeholder="e.g. Starbucks">`;
            else if(step === 'category') container.innerHTML = `<select id="stepInput"><option>Food</option><option>Shopping</option><option>Bills</option><option>Groceries</option><option>Travel</option></select>`;
            else container.innerHTML = `<input type="date" id="stepInput" value="${tempItem.date}">`;

            document.getElementById('nextBtn').innerText = currentStep === steps.length - 1 ? "Save Purchase" : "Next";
        }

        function handleNext() {
            const val = document.getElementById('stepInput').value;
            if(!val) return;
            tempItem[steps[currentStep]] = val;

            if(currentStep < steps.length - 1) {
                currentStep++;
                updateStepUI();
            } else {
                purchases.push({...tempItem, id: Date.now()});
                save();
                closeAll();
            }
        }

        // Settings
        function openSettings() {
            document.getElementById('payInput').value = settings.pay;
            document.getElementById('settingsSheet').classList.add('active');
            document.getElementById('overlay').style.display = 'block';
        }

        function saveSettings() {
            settings.pay = Number(document.getElementById('payInput').value);
            localStorage.setItem('v5_set', JSON.stringify(settings));
            closeAll();
            render();
        }

        // Delete & Storage
        function deleteItem(id) {
            if(confirm("Delete this transaction?")) {
                purchases = purchases.filter(p => p.id !== id);
                save();
            }
        }

        function save() {
            localStorage.setItem('v5_data', JSON.stringify(purchases));
            render();
        }

        function closeAll() {
            document.querySelectorAll('.sheet').forEach(s => s.classList.remove('active'));
            document.getElementById('overlay').style.display = 'none';
        }

        function toggleSearch() { document.getElementById('searchBar').classList.toggle('hidden'); }

        // Render Logic
        function render() {
            const filter = document.getElementById('searchInput').value.toLowerCase();
            const filtered = purchases.filter(p => p.merchant.toLowerCase().includes(filter));
            
            const spent = purchases.reduce((sum, p) => sum + Number(p.amount), 0);
            const income = settings.pay * 2;
            const saved = income - spent;

            document.getElementById('totalSpent').innerText = `$${spent.toLocaleString()}`;
            document.getElementById('totalIncome').innerText = `$${income.toLocaleString()}`;
            document.getElementById('totalSaved').innerText = `$${saved.toLocaleString()}`;
            document.getElementById('savingsBanner').innerText = `On track to save $${saved.toLocaleString()} this month`;

            document.getElementById('purchaseList').innerHTML = filtered.reverse().map(p => `
                <div class="item-card">
                    <div class="item-info"><strong>${p.merchant}</strong><small>${p.category} ‚Ä¢ ${p.date}</small></div>
                    <div class="item-right">
                        <strong>$${Number(p.amount).toFixed(2)}</strong>
                        <button class="delete-btn" onclick="deleteItem(${p.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function renderTrends() {
            // Static example bars - logic can be added to group by week
            const data = [200, 450, 300, 550];
            document.getElementById('weeklyChart').innerHTML = data.map(v => `
                <div class="bar-container">
                    <div class="bar" style="height: ${(v/600)*100}%"></div>
                    <span style="font-size:10px; color:var(--gray); margin-top:5px;">$${v}</span>
                </div>
            `).join('');

            const cats = purchases.reduce((acc, p) => {
                acc[p.category] = (acc[p.category] || 0) + Number(p.amount);
                return acc;
            }, {});

            document.getElementById('categoryChart').innerHTML = Object.entries(cats).map(([name, amt]) => `
                <div class="stat-card" style="margin-bottom:10px; text-align:left;">
                    <div style="display:flex; justify-content:space-between;">
                        <strong>${name}</strong><span>$${amt.toFixed(2)}</span>
                    </div>
                </div>
            `).join('');
        }

        render();
    </script>
</body>
</html>
